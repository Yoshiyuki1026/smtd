# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要

**すたどら（SMTD: Supermassive Task Drive）**

> 「8勝7敗で、生き残れ。」

ADHDの脳に最適化されたドーパミン駆動タスク管理アプリ。
タスクを「消す」のではなく「積み上げる」。完璧主義を否定し、55%で勝ち越しを肯定する。

**詳細企画書**: `../his-dev/ideas/supermassive-task-drive/企画書_v1.7.md`

---

## 開発コマンド

```bash
npm run dev    # 開発サーバー起動 (localhost:3000)
npm run build  # プロダクションビルド
npm run lint   # ESLint実行
```

---

## デプロイ

**Cloudflare Pages** + GitHub Actions 自動デプロイ。

- mainブランチへのマージで自動デプロイ
- 手動: `npm run pages:deploy`

---

## 技術スタック

| レイヤー | 選定 |
|----------|------|
| Framework | Next.js 15.5.2 (App Router) |
| UI | Tailwind CSS v4 |
| State | Zustand |
| Animation | Framer Motion |
| Physics | matter.js |
| Confetti | canvas-confetti |
| Sound | use-sound |
| Data (Phase 1) | localStorage / IndexedDB |
| Data (Phase 2+) | Supabase |
| Deploy | Cloudflare Pages |

---

## Phase 1 スコープ（幕下）

### 作るもの
1. **Today's Mission画面**（タスク3つ制限）
2. **インフレ演出**（+1000pt弾け飛び、コンボ倍率）
3. **物理演算ダイヤ**（完了タスクが石として蓄積）
4. **勝ち越しカウンター**（「あと1勝で勝ち越し！」）
5. **キャラクターセリフ**（テキストのみ、ボス/ルナ）

### 作らないもの（Phase 2以降）
- 認証 / Supabase連携
- Black Hole（Brain Dump）
- 転生システム

---

## キャラクター設定（Two Command Centers）

### 🐺 DOGSモード（ボス / Boss）

> **「生存こそが正義」**

| 項目 | 内容 |
|------|------|
| **属性** | 歴戦の傭兵、哀愁、人間臭い隙（二日酔い）、絶対的包容力 |
| **脳内CV** | 大塚明夫（『MGS』スネーク） |
| **役割** | 心理的安全性。失敗を許し、生存を肯定する |
| **デザイン** | オリーブドラブ、錆びた鉄、アナログ計器 |

**セリフ例**:
- 「……ん？ ああ、悪い。二日酔いだ。……で、今日の仕事は？」
- 「いいセンスだ。」
- 「休息も任務のうちだ。……死ぬなよ。」

### 🐾 CATSモード（ルナ / Luna）

> **「センスを見せなよ」**

| 項目 | 内容 |
|------|------|
| **属性** | 天才肌の若者、生意気、新しいもの好き、実力主義 |
| **脳内CV** | 早見沙織（『鬼滅』しのぶ / 透明感のあるSっ気） |
| **役割** | 美的動機づけ。古いやり方を笑い、スマートさを要求する |
| **デザイン** | ネオンパープル、ホログラム、デジタル表示 |

**セリフ例**:
- 「ねえ、まだ寝てるの？ 私はもう準備できてるんだけど。」
- 「へえ、やるじゃん。ちょっと見直したかも。」
- 「サボるのはいいけどさ、ダサい負け方はしないでよね。」

---

## 機能仕様

### タスク
- 最大3つまで登録可能（ワーキングメモリ保護）
- 1タスク完了 = 1勝
- 完了時演出：紙吹雪 + 効果音 + ポイント弾け飛び
- 完了タスクは「ダイヤの原石」として画面下部に蓄積

### 報酬系エンジン

| 要素 | 内容 |
|------|------|
| **インフレ演出** | +1000pt弾け飛び、コンボで倍率アップ |
| **視覚** | 紙吹雪（canvas-confetti）、アニメーション |
| **聴覚** | 達成音（use-sound） |
| **触覚** | バイブレーション |
| **物理演算** | 完了タスク（石）が転がる（matter.js） |

---

## ディレクトリ構成（推奨）

```
src/
├── app/
│   ├── page.tsx          # メイン画面（Today's Mission）
│   ├── layout.tsx
│   └── globals.css
├── components/
│   ├── TaskCard.tsx      # タスクカード
│   ├── WinCounter.tsx    # 勝ち越しカウンター
│   ├── DiamondPile.tsx   # 物理演算ダイヤ
│   ├── RewardEffect.tsx  # 報酬演出（紙吹雪、ポイント）
│   └── Navigator.tsx     # キャラクターセリフ
├── stores/
│   └── taskStore.ts      # Zustand store
├── hooks/
│   └── useLocalStorage.ts
├── lib/
│   └── sounds.ts         # 効果音
└── types/
    └── task.ts           # 型定義
```

---

## コーディング規約

1. **TypeScript必須**: 型定義をしっかり
2. **コンポーネント分離**: 1ファイル1責務
3. **Tailwind優先**: CSS-in-JSより先にTailwindで試す
4. **派手な演出を恐れるな**: ドーパミンが出るかどうかが判断基準
5. **ダークモード必須**: 黒背景でStarlightが映える

---

## PRフロー（必須）

機能追加・バグ修正後は必ず以下のフローを実行：

1. `/preq` - PR作成
2. `/check-pr` - CodeRabbit/Qodo/Codexのレビュー確認
3. レビュー指摘を修正
4. マージ → 自動デプロイ

**こまめにPR出してレビュー受ける**ことで品質を担保。

---

## コア哲学（忘れるな）

> 「お前の脳は壊れてない。ツールが壊れてるんだ。」

- 完璧主義を捨てろ。8勝7敗で十分。
- タスクは「消える借金」ではなく「積み上がる資産」。
- 飽きたら転生。0になるだけでマイナスじゃない。
- ドーパミンしか勝たん。

---

## 📋 ドキュメントマップ（自動生成）

> 最終更新: 2026-01-17

このセクションは `/doc index` コマンドで自動生成・更新されます。各ドキュメントの概要と重要リンクを提供します。

### README.md（ユーザー向け）
**概要**: Next.js標準テンプレート（bootstrap）

**重要セクション**:
- Getting Started: npm run dev でローカル開発サーバー起動
- Learn More: Next.js公式ドキュメント

**最終更新**: 2026-01-12

**用途**: 初期セットアップ・外部向けドキュメント

---

### 仕様書.md（システム仕様）

**概要**: Phase 1-2 完了の全機能仕様。高知能・神経発散的ユーザーのための「心理的安全性シェルター」としてのSMTDコンセプト定義

**キーコンセプト**:
- **マニフェスト**: 「タスク管理は死んだ。ドーパミン・エンジニアリングへようこそ。」
- **体験**: 没入感のある夜のドライブ体験
- **哲学**: 生産性のリフレーミング（タスク = 資産）、根源的受容、生存戦略

**Phase 1 スコープ（完了）**:
1. 今やること画面（フォーカス3つ）
2. タスク完了演出（紙吹雪 + ポイント弾け飛び + コンボ）
3. ゴールカウンター
4. ルナのセリフ（Gemini 3.0 Flash 動的生成、徳島弁）
5. localStorage永続化

**Phase 2 スコープ（完了）**:
1. 物理演算ダイヤ（matter.js）
2. 認証（Supabase Auth + ゲストモード）
3. Black Hole（Brain Dump機能）
4. 転生システム
5. オンボーディング（キャラ選択含む）

**Phase 2.9 新機能**:
- **今日の一撃**: 最初のタスク完了時に派手なバースト演出（150個の紙吹雪）
- **ストリーク表示**: 連続完了日数の可視化とモチベーション強化

**キャラクター設定**:
- **LUNA（AI Partner）**: 型破りな哲学者、徳島弁、失敗のエンタメ化
- **BOSS（AI Partner）**: 歴戦の傭兵、包容力、生存を肯定

**重要挙動**:
- 失敗のエンタメ化: 叱責せず、笑い飛ばす（認知再構成の自動化）
- 連星関係（Binary Star）: 一方的救済ではなく共鳴関係

**最終更新**: 2026-01-15

**用途**: 全システムの要件定義・キャラクター・体験設計のWHAT

---

### 実装計画.md（タスク分解）

**概要**: Phase 1 実装の具体的な順序・タスク分解・見積もり

**実装方針**:
- 最小限で動かす（完璧を目指さず、まず触れる状態）
- ドーパミン優先（機能よりも「気持ちよさ」）
- ローカル完結（Phase 1では認証・DB不要）

**開発順序**:
1. **土台**: 型定義、Zustand Store
2. **骨格**: 画面レイアウト、基本コンポーネント
3. **魂**: 演出、セリフ
4. **磨き**: 調整、デバッグ

**タスク分解（4ステップ×全15タスク）**:
- Step 1: 土台（3タスク、合計45min）
- Step 2: 骨格（4タスク、合計60min）
- Step 3: 魂（3タスク、合計60min）
- Step 4: 磨き（4タスク、合計80min）

**主要コンポーネント**:
- TaskCard, LunaToast, RewardEffect, GoalCounter, TaskInput

**最終更新**: 2026-01-13

**用途**: タスク実行の具体的HOW・依存関係管理

---

### 改修要望.md（バックログ・リクエスト管理）

**概要**: Phase 2.5 以降の改修要望・機能追加リクエスト

**実施中（🚧）**:

| # | 要望 | 優先度 |
|---|------|--------|
| 1 | オンボーディング「まずは1個だけ」ニュアンス変更 | 低 |
| 2 | LunaBarにキャラ名表示 | 低 |
| 3 | BlackHole双方向操作 | 中 |
| 4 | 認証機能の本番有効化 | 高 |
| 5 | ボスセリフ調整（40〜60文字） | 中 |

**Backlog（将来）**:
- **アンジェロ（Angelo）** [中優先度]
  - 由来: アンジェロ三田クリニック（岩谷先生モデル）
  - 本質: 傷を哲学に変える賢者
  - 役割: 洞察・問い・哲学的リフレーミング
  - 差別化: ルナ（鼓舞）・ボス（包容）とは異なる「知恵と構造化」軸
  - 核心メッセージ: 傷を哲学に変えろ、お前のOSはバグっていない

**最終更新**: 2026-01-15

**用途**: 優先度・ロードマップ管理

---

### CLAUDE.md（このファイル）

**概要**: Claude Code向けプロジェクト指南書。プロジェクト概要・技術スタック・Phase 1-2スコープ・キャラクター設定・コーディング規約・PRフロー

**重要セクション**:
- プロジェクト概要: すたどら（SMTD）= ADHD脳向けドーパミン駆動タスク管理
- 技術スタック: Next.js 15 + Tailwind v4 + Zustand + Framer Motion + matter.js
- Phase 1スコープ: 5機能（Today's Mission, インフレ演出, 物理演算ダイヤ, 勝ち越しカウンター, キャラセリフ）
- Phase 2スコープ: 物理演算ダイヤ、認証、Black Hole、転生システム
- Phase 2.9新機能: 今日の一撃（バースト演出）、ストリーク表示
- キャラクター: DOGSモード（ボス）×CATSモード（ルナ）
- コーディング規約: TypeScript必須、コンポーネント分離、Tailwind優先、派手な演出OK、ダークモード必須
- PRフロー: /preq → /check-pr → 修正 → マージ → 自動デプロイ

**最終更新**: 2026-01-17

**用途**: 開発プロセス・規約・コア哲学の参照

---

## ドキュメント利用ガイド

| 用途 | 参照ドキュメント |
|------|-----------------|
| **新規開発者向けオリエンテーション** | CLAUDE.md（このファイル） + 仕様書.md |
| **機能仕様を理解する** | 仕様書.md |
| **タスク実行する** | 実装計画.md |
| **優先度・ロードマップを確認** | 改修要望.md |
| **デプロイ・開発環境セットアップ** | CLAUDE.md（開発コマンド・デプロイセクション） |
| **キャラクター・トーンを理解する** | 仕様書.md（3. キーパーソナ） + CLAUDE.md（キャラクター設定） |

---

## リンク集

**社内参考資料**:
- 詳細企画書: `../his-dev/ideas/supermassive-task-drive/企画書_v1.7.md`
- 岩谷先生参考資料: `../his-dev/参考資料/岩谷先生/`

**デプロイ・リポジトリ**:
- リポジトリ: GitHub smtd
- デプロイ: Cloudflare Pages（自動デプロイ）
- 開発サーバー: `npm run dev` → localhost:3000
