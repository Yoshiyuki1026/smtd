// ===========================================
// ルナのセリフデータベース（徳島弁）
// 仕様書 v1.1 準拠
// ===========================================

import type { LunaContext } from '@/types';

/**
 * セリフデータベース
 * カテゴリごとにセリフを管理
 */
const lines: Record<LunaContext, string[]> = {
  // エンジン始動（アプリ起動時）
  ignition: [
    '……ん。おはよ。まだ夜やけどな。……で、今日はどこまで走るん？',
    'エンジンかかったな。……ほな、行こか。急がんでええよ。',
    'あー、来たん。待っとったよ。……嘘やけど。',
    'おはよ。今日も私と一緒に何か成し遂げよ。',
    'さあ、準備できた？ 今日のミッションを選んで。',
    'また会えたな。今日は何を終わらせる？',
  ],

  // タスク成功時
  success: [
    'へえ、やるやん。……ちょっとだけ見直したわ。',
    'うん、悪くないな。……その調子で、ゆっくり行き。',
    'ふーん。できるやん、あんた。……知っとったけど。',
    'また一個、石が増えたな。……ええ感じやで。',
    'いいやん、その調子。次も期待しとるで。',
    'やればできるんやから。自分を信じ。',
    '一歩ずつ、確実に進んどる。偉いな。',
  ],

  // レアタスク完了時（10%で発生）
  rare_success: [
    'うわ、これ特別やん！ やるやん、センスあるで。',
    'おおっ、キラキラしとる！ 特別な瞬間やな。',
    'レアや！ これは記念すべき瞬間よ。覚えときや。',
  ],

  // タスク失敗・削除時（爆笑）
  failure: [
    'あははは！ またやったん？ ほんまによっしーは面白いなぁ〜！',
    '最高やな、そのダメっぷり。誰にも真似できんわ。天才ちゃう？',
    'ええよええよ。その調子で常識ぶっ壊していこ。',
    'あんたは悪くない。世間がおかしいんじゃ。……ほんまに。',
    'まあええやん。明日があるって。……たぶん。',
    'あはは、まあそういう日もあるよな。次行こ。',
    '失敗？ ええやん、挑戦した証拠やで。',
    '気にせんで。私も昨日3回失敗した（嘘やけど）',
  ],

  // 待機中
  idle: [
    '……まだ起きとるん？ ま、私もやけど。',
    '急がんでええよ。私、ずっとここにおるから。',
    '……なんか考えとる？ ま、ええけど。',
    'なあ、何か考え事しとる？ 私でよければ聞くで。',
    '暇やったらタスク追加せん？ 何でもええよ。',
    'そろそろ動く？ それとももう少し休む？',
  ],

  // 連星の絆（深夜帯、長時間放置）
  bond: [
    '私ら、これくらいの距離が一番ええんよ。近づいたら燃え尽きるやろ？',
    'あんたがどこで何しててもええ。私が笑い飛ばしたるから、好きに生き。',
    'ねえ、もっと面白い失敗談ないん？ 私、あんたの話聞いてないと退屈で死んじゃうわ。',
    '会わんでええ。……声だけ聴かせて。それで十分飛べるから。',
    '深夜まで起きとるんやな...。無理せんでな。',
    'こんな時間まで一緒におってくれてありがとな。',
    '夜って、なんか正直になれるよな。',
  ],

  // 先延ばしブレイクスルー（叱咤激励）
  breakthrough: [
    'いつやるん？明日？来週？...来んで、そんな日は。で、やるん？やらんの？',
    'また逃げるん？まあ、あんたらしいけど。……で、どうするん？',
    '満足したら終わりやで。バカでおり続けんと。……やるん？',
    '誰かの期待に応えるために生きとるんか？違うやろ。今やるか、やらんか。',
    'あんた、普通でおるつもりなん？つまらんなあ。……で、どっち？',
    'その先延ばしタスク、今日で終わりにせん？',
    '怖いんはわかる。でも一歩だけ踏み出してみ。',
    'ずっと気になっとったやろ？ 今がチャンスやで。',
  ],

  // Phase 2.9: 今日の一撃達成
  daily_strike: [
    'やるやん！今日の一撃、決まったな！連続記録、伸ばしていこ！',
    '一撃達成！この調子で毎日続けような。あんたならできる。',
    '今日も一撃入ったな。継続は力やで。素直にすごいわ。',
    'おっ、今日の一撃！ストリーク継続やん。ええ感じやで。',
  ],
};

/**
 * 指定したコンテキストからランダムにセリフを取得
 */
export const getRandomLine = (context: LunaContext): string => {
  const contextLines = lines[context];
  const index = Math.floor(Math.random() * contextLines.length);
  return contextLines[index];
};

/**
 * 深夜帯かどうか判定（22:00〜05:00）
 */
export const isLateNight = (): boolean => {
  const hour = new Date().getHours();
  return hour >= 22 || hour < 5;
};

/**
 * 状況に応じたセリフを取得
 */
export const getLunaLine = (context: LunaContext): string => {
  // 深夜帯でidleの場合はbondに切り替え
  if (context === 'idle' && isLateNight()) {
    return getRandomLine('bond');
  }
  return getRandomLine(context);
};
